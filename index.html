<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Suns | Harvard Art Museums</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <style>
            html, body {margin: 0px;padding: 0px;overflow: hidden;font-family: verdana;}
            svg {border: 0px solid;}
            a {color:#000000;text-decoration: none;}
            a:hover {color:#ffffff;background: #000000;}

            #suns {overflow: hidden;position: fixed}
            #info {position: fixed;padding:10px;}
            #info #title {top: 10px;left:25px;}
        </style>
    </head>
    <body>
        <div id="suns"></div>
        <div id="info">
            <div id="title"></div>
        </div>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script src="d3/d3.v3.min.js"></script>
        <script type="text/javascript">
        //See https://github.com/mbostock/bost.ocks.org/blob/gh-pages/mike/nations/index.html

        // Chart dimensions.
        var margin = {top: 0, right: 0, bottom: 0, left: 0},
            width = $(window).width() - margin.right - margin.left,
            height = $(window).height() - margin.top - margin.bottom;

        var counter = 0;
        var threshold = 25;

        // Create the SVG container and set the origin.
        var svg = d3.select("#suns").append("svg")
            .attr("width", width)
            .attr("height", height)
            .on("click", blastColors)
          .append("g")
            .attr("transform", "translate(0,0)");

        window.setInterval(doWork, 1000);

        function doWork() {
            blastColors();
            eraseColors();
        }

        function blastColors() {
            // Load some data
            // var apiURL = "http://api.harvardartmuseums.org/collection/object/231249";
            var apiURL = "http://api.harvardartmuseums.org/collection/object?s=random&q=color:*&size=2";
            d3.json(apiURL, function(artwork) {
            
                $.each(artwork.records, function(i, item) {
                    var xPos = Math.floor(Math.random() * width);
                    var yPos = Math.floor(Math.random() * height);

                    var dot = svg.append("g")
                           .attr("class", "dots")
                           .attr("data-age", counter)
                        .selectAll(".dot")
                            .data(item.colors)
                        .enter().append("circle")
                            .attr("class", "dot")
                            .style("fill", function(d) { return d.color; })
                            .attr("cx", width/2)
                            .attr("cy", height/2)
                            .attr("r", function(d) { return d.percent*200; });
                    
                    dot.transition()
                        .attr("cx", xPos)
                        .attr("cy", yPos)
                        .delay(400);

                    $("#title").append('<a target="_window" href="' + item.url + '">' + item.title + '</a>, ');
                });

                counter++;
            });
        }

        function eraseColors() {
            var deadAge = counter - threshold;

            d3.selectAll("g[data-age='" + deadAge + "']")
                .transition()
                    .style("opacity", "0")
                    .duration(1000)
                    .each("end", function() {this.remove();});
        }
        </script>
    </body>
</html>